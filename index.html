<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #6d6d6d; -webkit-text-stroke: #6d6d6d}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #0000ff; -webkit-text-stroke: #0000ff}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #6b0001; -webkit-text-stroke: #6b0001}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #fb0007; -webkit-text-stroke: #fb0007}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; -webkit-text-stroke: #000000}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; -webkit-text-stroke: #000000; min-height: 16.0px}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #4d5055; -webkit-text-stroke: #4d5055}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #093c94; -webkit-text-stroke: #093c94}
    span.s1 {font-kerning: none; background-color: #ecf1f7}
    span.s2 {font-kerning: none; color: #fb0007; background-color: #ecf1f7; -webkit-text-stroke: 0px #fb0007}
    span.s3 {font-kerning: none; color: #2a2a2a; background-color: #ecf1f7; -webkit-text-stroke: 0px #2a2a2a}
    span.s4 {font-kerning: none; color: #6b0001; background-color: #ecf1f7; -webkit-text-stroke: 0px #6b0001}
    span.s5 {font-kerning: none; color: #000000; background-color: #ecf1f7; -webkit-text-stroke: 0px #000000}
    span.s6 {font-kerning: none; color: #0000ff; background-color: #ecf1f7; -webkit-text-stroke: 0px #0000ff}
    span.s7 {font-kerning: none}
    span.s8 {font-kerning: none; color: #093c94; background-color: #ecf1f7; -webkit-text-stroke: 0px #093c94}
    span.s9 {font-kerning: none; color: #18702b; background-color: #ecf1f7; -webkit-text-stroke: 0px #18702b}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE</span><span class="s2"> html</span><span class="s1">&gt;</span></p>
<p class="p2"><span class="s3">&lt;</span><span class="s4">html</span><span class="s5"> </span><span class="s2">lang</span><span class="s3">=</span><span class="s1">"zh-TW"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s3">&lt;</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s5"><span class="Apple-converted-space">  </span></span><span class="s3">&lt;</span><span class="s4">meta</span><span class="s5"> </span><span class="s1">charset</span><span class="s3">=</span><span class="s6">"UTF-8"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">  </span></span><span class="s3">&lt;</span><span class="s4">meta</span><span class="s5"> </span><span class="s2">name</span><span class="s3">=</span><span class="s1">"viewport"</span><span class="s5"> </span><span class="s2">content</span><span class="s3">=</span><span class="s1">"width=device-width, initial-scale=1.0"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s3">&lt;</span><span class="s4">title</span><span class="s3">&gt;</span><span class="s1">實驗數據統計平台</span><span class="s3">&lt;/</span><span class="s4">title</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">  </span></span><span class="s1">&lt;!-- 引入 Tailwind CSS 進行排版 --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">  </span></span><span class="s3">&lt;</span><span class="s4">script</span><span class="s5"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://cdn.tailwindcss.com"</span><span class="s3">&gt;&lt;/</span><span class="s4">script</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">  </span></span><span class="s1">&lt;!-- 引入 Phosphor Icons 圖示庫 --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">  </span></span><span class="s3">&lt;</span><span class="s4">script</span><span class="s5"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://unpkg.com/@phosphor-icons/web"</span><span class="s3">&gt;&lt;/</span><span class="s4">script</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">  </span></span><span class="s1">&lt;!-- 引入 React 與 ReactDOM --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">  </span></span><span class="s3">&lt;</span><span class="s4">script</span><span class="s5"> </span><span class="s2">crossorigin</span><span class="s5"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://unpkg.com/react@18/umd/react.production.min.js"</span><span class="s3">&gt;&lt;/</span><span class="s4">script</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">  </span></span><span class="s3">&lt;</span><span class="s4">script</span><span class="s5"> </span><span class="s2">crossorigin</span><span class="s5"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"</span><span class="s3">&gt;&lt;/</span><span class="s4">script</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">  </span></span><span class="s1">&lt;!-- 引入 Babel 讓瀏覽器可以直接編譯 React 語法 --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">  </span></span><span class="s3">&lt;</span><span class="s4">script</span><span class="s5"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://unpkg.com/@babel/standalone/babel.min.js"</span><span class="s3">&gt;&lt;/</span><span class="s4">script</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">  </span></span><span class="s1">&lt;!-- 引入 Recharts 繪製圖表 --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">  </span></span><span class="s3">&lt;</span><span class="s4">script</span><span class="s5"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://unpkg.com/recharts/umd/Recharts.min.js"</span><span class="s3">&gt;&lt;/</span><span class="s4">script</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">  </span></span><span class="s1">&lt;!-- 引入 html2canvas 用於截圖下載 --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">  </span></span><span class="s3">&lt;</span><span class="s4">script</span><span class="s5"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"</span><span class="s3">&gt;&lt;/</span><span class="s4">script</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s7"></span><br></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">  </span></span><span class="s3">&lt;</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s1">/* 隱藏捲軸但保留滾動功能 */</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s1">.hide-scrollbar::-webkit-scrollbar</span><span class="s5"> { </span><span class="s2">display:</span><span class="s5"> </span><span class="s8">none</span><span class="s5">; }</span></p>
<p class="p4"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s4">.hide-scrollbar</span><span class="s5"> { </span><span class="s1">-ms-overflow-style:</span><span class="s5"> </span><span class="s8">none</span><span class="s5">; </span><span class="s1">scrollbar-width:</span><span class="s5"> </span><span class="s8">none</span><span class="s5">; }</span></p>
<p class="p8"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s4">body</span><span class="s5"> { </span><span class="s2">font-family:</span><span class="s5"> </span><span class="s9">'Segoe UI'</span><span class="s5">, </span><span class="s1">Tahoma</span><span class="s5">, </span><span class="s1">Geneva</span><span class="s5">, </span><span class="s1">Verdana</span><span class="s5">, </span><span class="s1">sans-serif</span><span class="s5">; </span><span class="s2">background-color:</span><span class="s5"> </span><span class="s1">#f9fafb</span><span class="s5">; }</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">  </span></span><span class="s3">&lt;/</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s3">&lt;/</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s3">&lt;</span><span class="s1">body</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">  </span></span><span class="s1">&lt;!-- React 應用程式的掛載點 --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">  </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"root"</span><span class="s3">&gt;&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s7"></span><br></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">  </span></span><span class="s1">&lt;!-- 主程式碼 (Type 設定為 text/babel 與 module 以支援 Firebase 模組引入) --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">  </span></span><span class="s3">&lt;</span><span class="s4">script</span><span class="s5"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"text/babel"</span><span class="s5"> </span><span class="s2">data-type</span><span class="s3">=</span><span class="s1">"module"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>// --- 引入 Firebase 雲端模組 --- (統一使用官方 CDN 路徑)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";</span></p>
<p class="p6"><span class="s7"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>// 從全域變數中取得 React 與 Recharts 工具</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>const { useState, useEffect, useRef } = React;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, LabelList, LineChart, Line, PieChart, Pie, Cell } = window.Recharts;</span></p>
<p class="p6"><span class="s7"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>// --- 初始化 Firebase (防當機設計) ---</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>let app, auth, db;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>const appId = "my-experiment-platform"; // 專案固定 ID</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>// 使用你提供的 Firebase 設定</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>const firebaseConfig = {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>apiKey: "AIzaSyAdO41X5cNZmeC7SUGEt17hRXN3rgauUB8",</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>authDomain: "experiment-platform-489f0.firebaseapp.com",</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>projectId: "experiment-platform-489f0",</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>storageBucket: "experiment-platform-489f0.firebasestorage.app",</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>messagingSenderId: "291865361226",</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>appId: "1:291865361226:web:8ae57d4c5efc422e001fb3",</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>measurementId: "G-Z6PGSL59Y0"</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>};</span></p>
<p class="p6"><span class="s7"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>try {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>// 只有在填入正確金鑰時才啟動雲端功能</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>if (firebaseConfig.apiKey &amp;&amp; !firebaseConfig.apiKey.includes("你的_")) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>app = initializeApp(firebaseConfig);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>auth = getAuth(app);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>db = getFirestore(app);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>} else {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>console.warn("⚠️ Firebase 尚未設定，平台將以「離線模式」運行。");</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>} catch (err) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>console.error("Firebase 初始化失敗:", err);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p6"><span class="s7"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>// --- 常數與預設值 ---</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>const TEACHER_PWD = '8557';</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>const COLORS = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#06b6d4', '#ec4899'];</span></p>
<p class="p6"><span class="s7"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>const DEFAULT_DATA = { groups: ['紙飛機', '彈珠台'], data: {} };</span></p>
<p class="p6"><span class="s7"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>const createDefaultExperiment = () =&gt; ({</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>id: Date.now().toString(),</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>name: '未命名實驗',</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>recordMethod: '',</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>unit: '',<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>columns: ['測試一', '測試二'],</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>rows: [</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>{ id: `r-${Date.now()}-1`, name: '實驗組', description: '', values: { '測試一': 0, '測試二': 0 } },</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>{ id: `r-${Date.now()}-2`, name: '對照組', description: '', values: { '測試一': 0, '測試二': 0 } }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>]</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p6"><span class="s7"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>// ==========================================</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>// 主應用程式 App</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>// ==========================================</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>function App() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const [appData, setAppData] = useState(DEFAULT_DATA);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const [currentView, setCurrentView] = useState('login');<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const [currentGroup, setCurrentGroup] = useState('');</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const [modal, setModal] = useState(null);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const [user, setUser] = useState(null);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const [isCloudSyncing, setIsCloudSyncing] = useState(false);</span></p>
<p class="p6"><span class="s7"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const showModal = (config) =&gt; new Promise(resolve =&gt; setModal({ ...config, onResolve: resolve }));</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const handleModalSubmit = (result) =&gt; { if (modal &amp;&amp; modal.onResolve) modal.onResolve(result); setModal(null); };</span></p>
<p class="p6"><span class="s7"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>useEffect(() =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>if (!auth) return;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>const initAuth = async () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>try { await signInAnonymously(auth); }<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>catch (err) { console.error("驗證失敗:", err); }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>initAuth();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>const unsubscribeAuth = onAuthStateChanged(auth, setUser);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>return () =&gt; unsubscribeAuth();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>}, []);</span></p>
<p class="p6"><span class="s7"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>useEffect(() =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>if (!user || !db) return;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>setIsCloudSyncing(true);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'platformData', 'main');</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>const unsubscribeDb = onSnapshot(docRef, (docSnap) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>if (docSnap.exists()) setAppData(docSnap.data());</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>else setDoc(docRef, DEFAULT_DATA);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>setIsCloudSyncing(false);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}, (error) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>console.error("讀取雲端資料失敗:", error);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>setIsCloudSyncing(false);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>return () =&gt; unsubscribeDb();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>}, [user]);</span></p>
<p class="p6"><span class="s7"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const saveData = async (newData) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>setAppData(newData);<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>if (user &amp;&amp; db) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>setIsCloudSyncing(true);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>try {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'platformData', 'main');</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>await setDoc(docRef, newData);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>} catch (err) { console.error("儲存至雲端失敗:", err); }<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>finally { setIsCloudSyncing(false); }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>};</span></p>
<p class="p6"><span class="s7"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const handleEnterGroup = (group) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>setCurrentGroup(group);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>const newData = { ...appData };</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>if (!newData.data[group] || newData.data[group].length === 0) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>newData.data[group] = [createDefaultExperiment()];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>saveData(newData);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>setCurrentView('student');</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>};</span></p>
<p class="p6"><span class="s7"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>return (</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className="min-h-screen text-gray-800 font-sans"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>&lt;nav className="bg-blue-600 text-white p-4 shadow-md flex justify-between items-center"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div className="flex items-center gap-2"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>&lt;i className="ph ph-activity text-2xl"&gt;&lt;/i&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>&lt;h1 className="text-xl font-bold tracking-wide"&gt;實驗數據統計平台&lt;/h1&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div className="flex items-center gap-4"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>{(currentView === 'teacher' || currentView === 'student') &amp;&amp; (</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;button onClick={() =&gt; setCurrentView('login')} className="flex items-center gap-1 hover:bg-blue-700 px-3 py-1 rounded transition"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;i className="ph ph-sign-out text-lg"&gt;&lt;/i&gt; 返回首頁</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>)}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/nav&gt;</span></p>
<p class="p6"><span class="s7"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>&lt;main className="p-4 md:p-8 max-w-7xl mx-auto"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>{currentView === 'login' &amp;&amp; &lt;LoginView groups={appData.groups} onEnter={handleEnterGroup} onTeacherLogin={() =&gt; setCurrentView('teacher')} appData={appData} saveData={saveData} showModal={showModal} /&gt;}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>{currentView === 'teacher' &amp;&amp; &lt;TeacherView appData={appData} saveData={saveData} showModal={showModal} /&gt;}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>{currentView === 'student' &amp;&amp; &lt;StudentWorkspace group={currentGroup} appData={appData} saveData={saveData} showModal={showModal} isCloudSyncing={isCloudSyncing} isOnline={!!db} /&gt;}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/main&gt;</span></p>
<p class="p6"><span class="s7"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>{/* 彈窗 UI */}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>{modal &amp;&amp; (</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div className="fixed inset-0 bg-black/60 flex items-center justify-center z-[100] p-4"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div className={`bg-white p-6 rounded-xl shadow-2xl transform transition-all ${modal.type === 'image' ? 'w-[90vw] max-w-5xl' : 'w-96 max-w-[90vw]'}`}&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;h3 className="text-xl font-bold mb-4 text-gray-800"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                  </span>{modal.type === 'alert' ? '提示' : modal.type === 'confirm' ? '請確認' : modal.type === 'image' ? '圖片預覽 (請右鍵下載)' : '請輸入'}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/h3&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>{modal.type !== 'image' &amp;&amp; &lt;p className="mb-5 text-gray-600 leading-relaxed"&gt;{modal.message}&lt;/p&gt;}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>{modal.type === 'prompt' &amp;&amp; (</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                   </span>&lt;input autoFocus type="text" id="prompt-input" className="w-full p-3 border border-gray-300 rounded-lg mb-4 focus:ring-2 focus:ring-blue-500 outline-none" defaultValue={modal.defaultValue || ''} onKeyDown={(e) =&gt; { if(e.key === 'Enter') handleModalSubmit(e.target.value) }} /&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>)}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>{modal.type === 'image' &amp;&amp; (</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div className="flex flex-col items-center"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div className="w-full max-h-[65vh] overflow-y-auto bg-gray-100 border border-gray-300 rounded-lg mb-4 p-2 shadow-inner"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;img src={modal.imageUrl} alt="Exported Chart" className="w-full h-auto object-contain pointer-events-auto" /&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p className="text-md text-red-600 font-bold bg-red-50 px-4 py-2 rounded-lg border border-red-100"&gt;{modal.message}&lt;/p&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>)}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div className="flex justify-end gap-3 mt-2"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                  </span>{modal.type !== 'alert' &amp;&amp; modal.type !== 'image' &amp;&amp; (</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onClick={() =&gt; handleModalSubmit(null)} className="px-5 py-2 text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg transition font-medium"&gt;取消&lt;/button&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                  </span>)}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;button onClick={() =&gt; { if (modal.type === 'prompt') handleModalSubmit(document.getElementById('prompt-input').value); else handleModalSubmit(true); }} className="px-5 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium shadow-sm"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>{modal.type === 'image' ? '關閉預覽' : '確定'}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/button&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>)}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p6"><span class="s7"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>// ==========================================</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>// 子元件 (Login, Teacher, Student, Table, Chart)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>// ==========================================</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>function LoginView({ groups, onEnter, onTeacherLogin, appData, saveData, showModal }) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const [selectedGroup, setSelectedGroup] = useState(groups[0] || '');</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const [pwdModal, setPwdModal] = useState(false);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const [pwd, setPwd] = useState('');</span></p>
<p class="p6"><span class="s7"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const handleTeacherSubmit = async (e) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>e.preventDefault();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>if (pwd === TEACHER_PWD) { setPwdModal(false); setPwd(''); onTeacherLogin(); }<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>else { await showModal({ type: 'alert', message: '密碼錯誤！' }); }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>};</span></p>
<p class="p6"><span class="s7"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>return (</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className="flex flex-col items-center justify-center min-h-[70vh]"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>&lt;div className="bg-white p-8 rounded-xl shadow-lg w-full max-w-md text-center border border-gray-100"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;h2 className="text-2xl font-bold mb-6 text-gray-700"&gt;選擇組別&lt;/h2&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div className="mb-6"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>&lt;select className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" value={selectedGroup} onChange={(e) =&gt; setSelectedGroup(e.target.value)}&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>{groups.length === 0 &amp;&amp; &lt;option value=""&gt;無組別 (請教師新增)&lt;/option&gt;}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>{groups.map(g =&gt; &lt;option key={g} value={g}&gt;{g}&lt;/option&gt;)}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/select&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button onClick={() =&gt; selectedGroup &amp;&amp; onEnter(selectedGroup)} disabled={!selectedGroup} className="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 disabled:opacity-50 transition shadow-md"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>進入實驗平台</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/button&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;hr className="my-8 border-gray-200" /&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div className="flex justify-between gap-4"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>&lt;button onClick={() =&gt; setPwdModal(true)} className="flex-1 bg-gray-100 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-200 transition flex items-center justify-center gap-2 text-sm font-bold"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;i className="ph ph-gear text-lg"&gt;&lt;/i&gt; 教師後台</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/button&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>{pwdModal &amp;&amp; (</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div className="bg-white p-6 rounded-lg shadow-xl w-80"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;h3 className="text-xl font-bold mb-4"&gt;教師登入&lt;/h3&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;form onSubmit={handleTeacherSubmit}&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;input type="password" placeholder="請輸入密碼" className="w-full p-2 border rounded mb-4 focus:ring-2 focus:ring-blue-500 outline-none" value={pwd} onChange={e =&gt; setPwd(e.target.value)} autoFocus /&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div className="flex justify-end gap-2"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button type="button" onClick={() =&gt; setPwdModal(false)} className="px-4 py-2 text-gray-500 hover:bg-gray-100 rounded"&gt;取消&lt;/button&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button type="submit" className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"&gt;登入&lt;/button&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/form&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>)}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p6"><span class="s7"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>function TeacherView({ appData, saveData, showModal }) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const [newGroup, setNewGroup] = useState('');</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const handleAddGroup = async () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>const trimmed = newGroup.trim();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>if (!trimmed) return;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>if (appData.groups.includes(trimmed)) { await showModal({ type: 'alert', message: '組別已存在！' }); return; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>saveData({ ...appData, groups: [...appData.groups, trimmed] });</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>setNewGroup('');</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>};</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const handleRemoveGroup = async (group) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>const confirmed = await showModal({ type: 'confirm', message: `確定要刪除「${group}」嗎？` });</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>if (confirmed) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>const newData = { ...appData, groups: appData.groups.filter(g =&gt; g !== group) };</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>delete newData.data[group];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>saveData(newData);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>};</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>return (</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className="bg-white p-6 rounded-xl shadow border border-gray-100"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>&lt;h2 className="text-2xl font-bold flex items-center gap-2 mb-6"&gt;&lt;i className="ph ph-gear text-gray-500"&gt;&lt;/i&gt; 教師管理後台&lt;/h2&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>&lt;div className="mb-8"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;h3 className="text-lg font-semibold mb-3 border-b pb-2"&gt;組別管理&lt;/h3&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div className="flex gap-2 mb-4"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>&lt;input type="text" placeholder="輸入新組別名稱..." className="flex-1 max-w-sm p-2 border rounded-lg outline-none focus:border-blue-500" value={newGroup} onChange={(e) =&gt; setNewGroup(e.target.value)} onKeyDown={(e) =&gt; e.key === 'Enter' &amp;&amp; handleAddGroup()} /&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>&lt;button onClick={handleAddGroup} className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-1 font-bold"&gt;&lt;i className="ph ph-plus"&gt;&lt;/i&gt; 新增&lt;/button&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;ul className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>{appData.groups.map(g =&gt; (</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;li key={g} className="bg-gray-50 border p-3 rounded-lg flex justify-between items-center"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;span className="font-medium text-gray-700"&gt;{g}&lt;/span&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;button onClick={() =&gt; handleRemoveGroup(g)} className="text-red-500 hover:text-red-700 p-1.5 bg-red-50 rounded hover:bg-red-100 transition"&gt;&lt;i className="ph ph-trash text-lg"&gt;&lt;/i&gt;&lt;/button&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/li&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>))}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/ul&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p6"><span class="s7"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>function StudentWorkspace({ group, appData, saveData, showModal, isCloudSyncing, isOnline }) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const groupExps = appData.data[group] || [];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const [activeTabId, setActiveTabId] = useState(groupExps[0]?.id || null);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const [isExporting, setIsExporting] = useState(false);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>useEffect(() =&gt; { if (groupExps.length &gt; 0 &amp;&amp; !activeTabId) setActiveTabId(groupExps[0].id); }, [groupExps, activeTabId]);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const activeExp = groupExps.find(e =&gt; e.id === activeTabId) || groupExps[0];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const updateCurrentExperiment = (updatedExp) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>const newData = { ...appData }; newData.data[group] = groupExps.map(e =&gt; e.id === updatedExp.id ? updatedExp : e); saveData(newData);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>};</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const handleExportImage = async () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>const el = document.getElementById('export-area'); if (!el) return;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>try {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>setIsExporting(true); await new Promise(r =&gt; setTimeout(r, 400));<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>const canvas = await window.html2canvas(el, { backgroundColor: '#ffffff', scale: 2, useCORS: true });</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>setIsExporting(false);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>await showModal({ type: 'image', imageUrl: canvas.toDataURL('image/jpeg', 1.0), message: '👉 請在此圖片上點擊滑鼠右鍵，選擇「另存圖片」下載。' });</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>} catch (err) { setIsExporting(false); await showModal({ type: 'alert', message: '匯出失敗' }); }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>};</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>if (!activeExp) return &lt;div&gt;載入中...&lt;/div&gt;;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>return (</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className="space-y-4"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>&lt;div className="flex justify-between items-center bg-white p-4 rounded-lg shadow-sm border border-gray-100"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div className="flex items-center gap-3"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>&lt;span className="text-sm text-gray-700 font-bold bg-gray-100 px-3 py-1.5 rounded-lg"&gt;組別：{group}&lt;/span&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>&lt;span className={`text-xs flex items-center gap-1 px-2 py-1.5 rounded-lg border font-bold ${isCloudSyncing ? 'text-blue-600 bg-blue-50 border-blue-200' : 'text-green-600 bg-green-50 border-green-200'}`}&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;i className="ph ph-cloud"&gt;&lt;/i&gt; {isCloudSyncing ? '雲端同步中...' : '已儲存至雲端'}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/span&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button onClick={handleExportImage} className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-3 rounded-lg flex items-center gap-1 text-sm"&gt;&lt;i className="ph ph-image"&gt;&lt;/i&gt; 下載截圖&lt;/button&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>&lt;div className="flex overflow-x-auto gap-2 border-b pb-2"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>{groupExps.map(exp =&gt; (</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div key={exp.id} className={`px-4 py-2 rounded-t-lg cursor-pointer border-t border-l border-r ${activeTabId === exp.id ? 'bg-white font-bold text-blue-600 -mb-[9px]' : 'bg-gray-100'}`} onClick={() =&gt; setActiveTabId(exp.id)}&gt;{exp.name}&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>))}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button onClick={() =&gt; { const n = createDefaultExperiment(); saveData({...appData, data:{...appData.data, [group]:[...groupExps, n]}}); setActiveTabId(n.id); }} className="px-3 py-2 text-blue-600 font-bold"&gt;+ 新增&lt;/button&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>&lt;div id="export-area" className="bg-white p-6 rounded-b-xl shadow-sm border border-gray-200"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div className="mb-6 space-y-4"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div className="flex items-center gap-3"&gt;&lt;label className="font-bold"&gt;實驗名稱：&lt;/label&gt;&lt;input type="text" className="flex-1 p-2 border-b-2 outline-none font-bold focus:border-blue-500" value={activeExp.name} onChange={(e) =&gt; updateCurrentExperiment({ ...activeExp, name: e.target.value })} /&gt;&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div className="flex items-center gap-3"&gt;&lt;label className="font-bold"&gt;紀錄方式：&lt;/label&gt;&lt;input type="text" className="flex-1 p-2 border-b outline-none focus:border-blue-500" value={activeExp.recordMethod || ''} onChange={(e) =&gt; updateCurrentExperiment({ ...activeExp, recordMethod: e.target.value })} /&gt;&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div className="grid grid-cols-1 lg:grid-cols-2 gap-8"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>&lt;DataTable experiment={activeExp} updateExperiment={updateCurrentExperiment} isExporting={isExporting} /&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>&lt;DataChart experiment={activeExp} isExporting={isExporting} /&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p6"><span class="s7"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>function DataTable({ experiment, updateExperiment, isExporting }) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const { columns, rows } = experiment;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const update = (newRows) =&gt; updateExperiment({...experiment, rows: newRows});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>return (</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className="w-full flex flex-col"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>&lt;h3 className="font-bold text-gray-700 mb-3 flex justify-between"&gt;實驗數據 {!isExporting &amp;&amp; &lt;button onClick={() =&gt; updateExperiment({...experiment, columns: [...columns, `測試${columns.length+1}`]})} className="text-xs bg-green-100 text-green-700 px-2 rounded"&gt;+ 欄&lt;/button&gt;}&lt;/h3&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>&lt;div className="overflow-x-auto"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;table className="w-full text-left border-collapse text-sm"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>&lt;thead className="bg-gray-200"&gt;&lt;tr&gt;&lt;th className="p-2 border"&gt;項目&lt;/th&gt;{columns.map(c =&gt; &lt;th key={c} className="p-2 border"&gt;{c}&lt;/th&gt;)}&lt;th className="p-2 border"&gt;質性描述&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>&lt;tbody&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>{rows.map(row =&gt; (</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;tr key={row.id}&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;td className="p-2 border"&gt;{row.name}&lt;/td&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>{columns.map(c =&gt; &lt;td key={c} className="p-1 border"&gt;&lt;input type="number" className="w-full text-center p-1" value={row.values[c]||0} onChange={(e) =&gt; update(rows.map(r =&gt; r.id === row.id ? {...r, values: {...r.values, [c]: parseFloat(e.target.value)||0}} : r))} /&gt;&lt;/td&gt;)}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;td className="p-1 border"&gt;&lt;textarea className="w-full p-1 text-xs" value={row.description||''} onChange={(e) =&gt; update(rows.map(r =&gt; r.id === row.id ? {...r, description: e.target.value} : r))} rows={1} /&gt;&lt;/td&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/tr&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>))}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/tbody&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/table&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>&lt;div className="mt-4 flex items-center gap-2"&gt;&lt;label className="font-bold text-sm"&gt;單位：&lt;/label&gt;&lt;input type="text" className="border-b p-1 text-sm outline-none" value={experiment.unit||''} onChange={(e)=&gt;updateExperiment({...experiment, unit:e.target.value})} /&gt;&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p6"><span class="s7"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>function DataChart({ experiment, isExporting }) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const { columns, rows } = experiment;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>const chartData = columns.map(col =&gt; { const pt = { name: col }; rows.forEach(r =&gt; pt[r.name] = Number(r.values[col])||0); return pt; });</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>return (</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div className="h-full flex flex-col"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>&lt;h3 className="font-bold text-gray-700 mb-6 border-b pb-2"&gt;數據圖表&lt;/h3&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>&lt;div className="flex-1 min-h-[300px] bg-white p-4 rounded-xl border"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;ResponsiveContainer width="100%" height={300}&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>&lt;BarChart data={chartData}&gt;&lt;CartesianGrid strokeDasharray="3 3" vertical={false}/&gt;&lt;XAxis dataKey="name"/&gt;&lt;YAxis/&gt;&lt;Tooltip/&gt;&lt;Legend/&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>{rows.map((r, i) =&gt; &lt;Bar key={r.id} dataKey={r.name} fill={COLORS[i % COLORS.length]} isAnimationActive={!isExporting}/&gt;)}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/BarChart&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/ResponsiveContainer&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">      </span>);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p6"><span class="s7"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>const root = ReactDOM.createRoot(document.getElementById('root'));</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>root.render(&lt;App /&gt;);</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">  </span></span><span class="s3">&lt;/</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s3">&lt;/</span><span class="s1">body</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s3">&lt;/</span><span class="s1">html</span><span class="s3">&gt;</span></p>
</body>
</html>
